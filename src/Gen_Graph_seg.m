clear variables
addpath ode
addpath util
addpath analysis
addpath ../models/segmentationclock/

cd ode
compile('segclock','graph')
cd ..
model = seg_clock_pathway();

 [numData,textData,rawData]=xlsread('../models/segmentationclock/Axin2mRNA.csv');


%% Define discretization intervals
% State discretization
% Time between model checking steps (timse discretization)
dt = 5;
% Number of discrete time steps
nTime = 40;

%sres
%par normal
%p=[1.906048	0.2369088	3.869709	0.06556321	0.1905225	0.001903199	0.07010045	0.9665154	3.913986	3.865117	3.54926	6.638884E-01	6.964428E-01	4.749785E-01	6.623308E+00	2.971345E+00	1.221596E+00	9.963261E-01	3.618791E-02	8.809597E-02	4.451155E-01	6.434711E-02	2.546401E+00	7.884925E-01	2.187317E+00	6.273301E-01	1.028745E+00	6.753914E-01	5.184495E-02	6.921681E-02	8.689715E-01	0.08817549	1.584186	0.7010482	5.989474	0.6890269	3.58187	1.221283	0.4638509];
%par p val based
%p=[2.077999	0.1758946	3.07184	0.07894917	0.1833293	0.000945613	0.07683708	0.9708277	3.651762	3.184216	2.745071	5.510935E-01	7.272410E-01	3.375952E-01	1.084487E+01	3.224431E-01	8.374292E-01	9.595014E-01	2.640423E-02	2.548120E-01	1.189000E+00	4.058929E-01	1.876032E+00	6.895039E-01	2.060841E+00	5.333233E-01	6.195044E-01	6.269313E-01	8.015656E-02	5.730541E-03	2.983106E-01	0.3884279	1.357687	0.8831792	5.815654	0.3706036	3.486729	2.307285	0.6665078];
%GA
%par normal
%p=[1.554141	0.2831098	3.95757	0.1212511	0.1530456	0.001410827	0.1087973	0.9322299	1.818424	1.648012	1.139918	2.047966E-01	4.653830E-01	5.526072E-01	1.407584E+01	1.541675E+00	8.004642E-01	9.333692E-01	3.934946E-02	2.693157E-01	5.535815E-01	5.060457E-01	1.238367E+00	4.552276E-01	1.041178E+00	4.157262E-01	5.439717E-01	2.862643E-01	1.604113E-01	1.369127E-01	6.737767E-01	0.7002168	1.759515	0.8218746	3.128673	0.1259211	3.035257	1.059442	0.9131879];
%par p-val
%p=[1.804091	0.200487	2.206288	0.1554481	0.1913872	0.000721051	0.1030734	0.3940385	0.6690549	2.214018	1.721963	3.044522E-01	6.683109E-01	4.907321E-01	6.862224E-01	9.980990E-01	3.067083E-01	2.137776E-01	2.848549E-02	1.663943E-01	5.992288E-01	1.144690E+00	1.994868E+00	8.856181E-01	3.605655E+00	2.015843E-01	1.581676E+00	1.283110E-01	1.413841E-01	1.734554E-01	1.137164E-01	0.3783952	1.217012	0.7063535	3.615786	0.4037424	1.799461	2.098653	0.5203909];
%p=[1.800244e+00	1.798205e-01	1.900800e+00	1.249062e-01	4.768003e-02	1.592100e-03	1.026314e-01	5.421114e-01	4.223605e+00	2.541858e+00	1.279977e+00	4.516553e-01	7.445420e-01	4.254372e-01	7.136751e+00	2.662384e-01	5.517710e-01	9.045299e-01	2.254439e-02	9.366758e-01	6.757479e-01	1.120280e+00	2.857261e+00	9.502663e-01	3.331661e+00	3.692731e-01	1.142281e+00	7.563860e-01	3.375350e-02	1.717129e-01	3.302317e-02	1.459283e-01	1.070726e+00	5.046436e-01	1.504659e+00	4.302157e-01	2.645827e+00	1.681335e+00	9.869755e-01];
%0.8-p
%p=[2.21794E+00	2.58628E-01	4.19114E+00	1.09427E-01	1.84149E-01	5.85302E-04	9.14824E-02	8.34925E-01	1.87057E+00	2.90498E+00	2.90549E+00	6.60505E-01	6.21678E-01	4.76866E-01	3.49936E+00	1.83421E-01	9.45380E-01	9.89499E-01	3.32119E-02	2.73528E-01	9.47641E-01	9.50806E-01	2.63585E+00	8.95101E-01	2.92026E+00	1.62334E-01	8.79443E-01	7.38030E-01	1.50581E-01	1.81488E-01	9.00658E-01	7.78614E-01	1.40166E+00	7.28868E-01	8.57017E+00	7.80656E-01	5.86986E+00	2.38661E+00	8.77166E-01];
%0.8
%p=[1.85477E+00	2.25461E-01	3.01694E+00	1.06655E-01	1.22804E-01	1.62818E-03	1.06778E-01	1.39512E+00	1.96934E+00	2.35898E+00	3.09863E+00	2.50136E-01	6.26846E-01	2.87691E-01	4.66200E+00	1.43224E+00	1.18731E+00	9.95318E-01	3.65767E-02	5.86986E-02	5.04046E-01	8.75287E-02	2.46001E+00	6.60403E-01	2.23029E+00	3.11686E-02	2.35226E+00	3.52701E-02	1.14468E-01	1.08022E-01	6.79978E-01	9.59026E-01	1.34448E+00	7.77251E-01	8.06544E+00	3.54376E-01	6.37508E+00	3.09787E+00	5.37238E-01];
%0.9
%p=[2.270008e+00	1.777086e-01	3.681801e+00	6.868474e-02	1.398081e-01	1.274139e-03	6.987804e-02	1.299962e+00	1.901268e+00	3.204958e+00	3.108714e+00	4.161383e-01	6.714567e-01	4.291293e-01	1.331986e+01	1.755259e+00	9.412496e-01	9.813186e-01	3.362519e-02	2.950830e-01	1.098116e+00	1.988066e-01	1.390139e+00	9.668858e-01	3.276640e+00	6.531061e-01	8.591396e-01	5.732082e-01	1.417966e-01	1.218366e-01	9.259670e-01	6.457230e-01	1.744184e+00	8.397297e-01	6.891038e+00	5.663031e-01	6.327112e+00	1.090576e+00	6.747395e-01];
%0.9-p
%p=[2.31508E+00	2.35232E-01	4.59534E+00	7.17011E-02	1.94562E-01	5.34409E-04	9.17607E-02	1.13092E+00	4.07439E+00	3.35414E+00	3.23135E+00	2.12270E-01	7.05951E-01	4.89685E-01	2.54389E+00	4.64760E-01	1.31442E+00	9.81849E-01	1.61632E-02	9.34258E-02	7.89282E-01	6.43063E-01	2.71109E+00	9.28902E-01	2.26969E+00	6.19728E-01	5.67074E-01	3.96576E-01	8.74717E-02	1.39451E-01	5.61857E-01	3.42033E-01	1.35244E+00	8.07500E-01	8.82782E+00	4.85617E-01	4.52774E+00	2.12198E+00	6.82980E-01];
%GA
%0.8-p
%p=[1.76010E+00	2.11167E-01	2.19937E+00	1.66280E-01	1.70242E-01	1.82292E-03	8.62234E-02	1.28496E+00	4.53255E+00	2.33013E+00	1.57289E+00	6.53248E-01	4.68816E-01	5.84956E-01	3.37554E+00	7.39738E-01	3.23256E-01	1.59495E-01	2.96813E-02	1.16171E+00	9.92936E-01	5.99941E-01	2.28169E+00	6.83557E-01	2.15260E+00	3.98367E-01	6.57049E-01	7.14108E-01	1.35545E-01	1.73039E-01	2.94350E-01	7.22445E-01	8.98604E-01	5.24165E-01	1.16726E+00	2.97216E-01	3.07013E+00	2.87627E+00	9.80641E-01];
%0.8
%p=[2.19029E-01	3.23020E-01	1.47378E+00	1.24782E-01	1.53163E-01	1.96123E-03	9.33442E-02	8.54323E-01	2.23547E+00	3.43682E+00	3.18275E+00	7.29364E-01	2.42868E-01	7.44923E-02	1.15241E+01	4.48168E-01	4.28902E-01	9.16514E-01	3.77282E-02	4.58938E-02	9.32870E-01	1.36404E+00	2.74635E+00	4.44432E-01	1.49817E+00	4.47593E-02	1.99445E+00	4.27526E-01	1.60559E-01	1.63624E-01	9.14515E-01	7.72039E-01	1.22765E+00	6.52607E-01	8.15095E+00	1.21835E-01	1.84455E+00	2.89470E+00	5.49821E-01];
%0.9-p
%p=[9.68751E-01	2.13045E-01	1.51655E+00	1.39503E-01	2.82766E-02	3.96706E-04	1.05158E-01	9.30192E-01	2.12314E+00	5.42176E+00	2.56913E+00	5.05273E-01	6.88368E-01	5.61700E-01	7.23915E+00	1.23166E+00	1.08915E+00	5.88534E-01	7.64739E-03	1.02556E+00	2.95633E-01	1.31751E+00	1.40296E+00	7.08419E-01	2.13243E+00	5.02420E-01	1.17157E+00	6.08270E-01	1.09240E-01	1.82874E-01	1.62453E-01	6.65919E-01	1.08335E+00	6.93585E-01	7.86263E+00	7.17360E-01	5.47715E+00	1.85079E+00	5.62072E-01];
%0.9
%p=[2.76596E+00	2.64267E-01	5.25201E+00	1.05775E-01	1.06988E-01	1.45883E-03	1.13297E-01	1.03147E+00	3.07824E+00	2.43080E+00	2.05494E+00	6.87847E-01	7.74035E-01	4.88667E-01	8.27064E+00	2.10882E+00	1.10131E+00	8.53176E-01	2.84161E-02	8.75514E-02	2.23455E-01	1.16520E+00	1.95828E+00	6.29158E-01	2.89579E+00	9.58067E-01	2.60365E+00	2.39839E-01	2.54344E-02	4.82440E-02	8.62961E-01	9.84276E-01	1.33737E+00	5.58081E-01	7.17458E+00	4.56981E-01	3.97937E+00	3.14614E+00	3.00926E-01];
%p=[2.505669e+00	2.001428e-01	3.249564e+00	6.301218e-02	1.919948e-01	3.313951e-04	7.635280e-02	1.212911e+00	3.475794e+00	3.713543e+00	3.766561e+00	4.300797e-01	7.287051e-01	4.636491e-01	7.702427e+00	1.847384e+00	9.657120e-01	9.888037e-01	3.784745e-02	1.186739e-01	1.126528e+00	2.840164e-02	2.477922e+00	9.457535e-01	2.974533e+00	5.102016e-01	8.089107e-01	7.412070e-01	1.078428e-01	1.470734e-01	5.443449e-01	3.308580e-01	1.328168e+00	7.471225e-01	7.353199e+00	7.352918e-01	5.147971e+00	2.147856e+00	6.585614e-01];
%p=[2.270008e+00	1.777086e-01	3.681801e+00	6.868474e-02	1.398081e-01	1.274139e-03	6.987804e-02	1.299962e+00	1.901268e+00	3.204958e+00	3.108714e+00	4.161383e-01	6.714567e-01	4.291293e-01	1.331986e+01	1.755259e+00	9.412496e-01	9.813186e-01	3.362519e-02	2.950830e-01	1.098116e+00	1.988066e-01	1.390139e+00	9.668858e-01	3.276640e+00	6.531061e-01	8.591396e-01	5.732082e-01	1.417966e-01	1.218366e-01	9.259670e-01	6.457230e-01	1.744184e+00	8.397297e-01	6.891038e+00	5.663031e-01	6.327112e+00	1.090576e+00	6.747395e-01];
%p=[2.381912e+00	1.852111e-01	1.463067e+00	7.231824e-02	1.217246e-01	1.418877e-03	9.842603e-02	1.201304e+00	2.325995e+00	3.068412e+00	3.011037e+00	6.675266e-01	5.443866e-01	3.167270e-01	1.046688e+01	4.888610e-01	1.292599e+00	9.896424e-01	3.581297e-02	3.709600e-01	9.619215e-01	4.382208e-01	2.797717e+00	8.066152e-01	2.215964e+00	4.971362e-01	4.530407e-01	3.783922e-01	1.557948e-02	1.057077e-01	9.157357e-01	9.542378e-01	1.563589e+00	9.487397e-01	5.636928e+00	6.991011e-01	3.027937e+00	2.704764e+00	7.157112e-01];
 
p=[1.946124e+00	2.030807e-01	3.154040e+00	1.214828e-01	7.917849e-02	4.098157e-04	8.713994e-02	5.743322e-01	2.825969e+00	4.208421e+00	3.173743e+00	6.568251e-01	7.074218e-01	5.655853e-01	1.096953e+01	1.559569e+00	1.257708e+00	9.785447e-01	3.268762e-02	6.875398e-02	7.944624e-01	3.571620e-01	2.993485e+00	5.621759e-01	1.706217e+00	2.408115e-01	1.290210e+00	5.794561e-01	7.620780e-02	1.423576e-01	7.960528e-01	8.688929e-01	1.269767e+00	7.282411e-01	3.704686e+00	2.154136e-01	4.761561e+00	1.540878e+00	7.818258e-01];


B = model.p_nominal;
	
for i=1:length(model.p_estimate)
	B(:,(model.p_estimate(i)))= p(:,i);
end

samples=1000;
for pp=1:samples
	disp(pp);
	xInit = samplingScheme(model.x_init,'uniform',0.05);
	B = samplingScheme(B,'uniform',0.0025);
     for i=1:length(model.p_nominal)
             if find(model.p_estimate==i)
             else 
                 B(i)= model.p_nominal(i);
             end
     end
    
    
    tf = Gen_Graph(B,xInit,nTime,dt);
    
	AB{pp} = transpose(reshape(tf,length(model.x_init),nTime));

end

t= linspace(0,nTime*dt,nTime);

save('seg_paramest')


%%
load('seg_paramest')
idx=[1 3 4 13 15];
chooseidx = [1 3 4];
xidx = idx(chooseidx);
nplot = length(xidx);
h=figure();
p=1;
for k=1:nplot
	subplot(1,nplot,k);	
	for pp=1:samples
		plot(t,AB{pp}(:,xidx(k)),'LineWidth',2,'Color',[0.4,0.4,0.4]);
		hold on;
	end
	
	title(strcat( model.x_names{xidx(k)}),'FontSize',13);
	set(gca,'FontSize',12)
end

%%
subplot(1,nplot,nplot);
specid = 11;
for pp=1:samples
	axis([0 nTime*dt 0 1.2*max(max(AB{pp}(:,specid)),max(numData(:,2)))]);
	plot(t, AB{pp}(:,specid),'LineWidth',2,'Color',[0.4,0.4,0.4]);
	hold on;
end

 title(strcat(model.x_names{specid}),'FontSize',13);
 errorbar((numData(:,1)*dt),numData(:,2),numData(:,2)*0.1,'ks','MarkerEdgeColor','k',...
	 'MarkerFaceColor','w','MarkerSize',5);
 set(gca,'FontSize',12)
hold on;


%saveas(h,strcat('../../models/segmentationclock/resultsandgraphs/0.2-5range/sres-1-',model.x_names{str2num(textData{i}(2:end))}),'jpg');
%%

a=[16];
h=figure();
p=1;
for k=1:length(model.x_init)
	if find(k==a)
	subplot(1,1,p);	
	p=p+1;
	for pp=1:samples
		plot(t,AB{pp}(:,k),'LineWidth',2,'Color',[0.4,0.4,0.4]);
		hold on;
	end
	
	title(strcat( model.x_names{k}),'FontSize',13);
	set(gca,'FontSize',12)
	end
end
